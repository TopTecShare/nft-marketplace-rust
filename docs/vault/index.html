<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Mobile Specific Meta -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Always force latest IE rendering engine or request Chrome Frame -->
        <!--[if IE]>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <![endif]-->
        <!-- Meta Description -->
        <meta name="description" content="The Varda Vault is built to attach or redeem unlockable content on the NEAR NFT ecosystem">
        <!-- Meta Keyword -->
        <meta name="keywords" content="unlockable, NFT, nearprotocol, blockchain, redeem, lock, content">
	<!-- twitter -->
	<meta name="twitter:title" content="The Varda Vault"/>
	    <meta name="twitter:card" content="summary_large_image"/>
	    <meta name="twitter:site" content="@jeeltcraft"/>
	    <meta name="twitter:description" content="The Varda Vault is built to attach or redeem unlockable content on the NEAR NFT ecosystem"/>
	    <meta name="twitter:image" content="https://www.varda.vision/img/twitter-preview.jpg"/>
        <!-- meta character set -->
        <meta charset="utf-8">

        <!-- Site Title -->
        <title>The Varda Vault</title>
        
		<link rel="shortcut icon" type="image/x-icon" href="https://www.varda.vision/img/icons/favicon.png">
      
      <style>
      @import url("https://fonts.googleapis.com/css?family=Source+Code+Pro");

.json {
  font-family: "Source Code Pro", monospace;
  font-size: 16px;

  & > {
    .json__item {
      display: block;
    }
  }
}

.json__item {
  display: none;
  margin-top: 10px;
  padding-left: 20px;
  user-select: none;
}

.json__item--collapsible {
  cursor: pointer;
  overflow: hidden;
  position: relative;

  &::before {
    content: "+";
    position: absolute;
    left: 5px;
  }

  &::after {
    background-color: lightgrey;
    content: "";
    height: 100%;
    left: 9px;
    position: absolute;
    top: 26px;
    width: 1px;
  }

  &:hover {
    & > .json__key,
    & > .json__value {
      text-decoration: underline;
    }
  }
}

.json__toggle {
  display: none;

  &:checked ~ .json__item {
    display: block;
  }
}

.json__key {
  color: darkblue;
  display: inline;

  &::after {
    content: ": ";
  }
}

.json__value {
  display: inline;
}

.json__value--string {
  color: green;
}

.json__value--number {
  color: blue;
}

.json__value--boolean {
  color: red;
}
</style>
</header>
<body>
<h1>Show tokens by mintbase store</h1>
<form onsubmit="run();">
    Store: 
    <input class="store" type="textbox">
    <input type="submit" value="Submit">
</form>
<div class="target" />
  <script type="text-javascript">
  const run = async () => {
  var store = document.querySelector('.store').value;
fetch("https://mintbase-mainnet.hasura.app/v1/graphql", {
  "headers": {
    "content-type": "application/json",
  },
  "body": "{\"query\":\"query MyQuery {\\n  store(where: {name: {_eq: \\\""+store+"\\\"}}) {\\n    things {\\n      tokens {\\n        id\\n        ownerId\\n      }\\n      metaId\\n    }\\n  }\\n}\",\"variables\":null,\"operationName\":\"MyQuery\"}",
  "method": "POST",
})
.then(response => response.json())
.then(function(response) { 
    var el = document.querySelector('.target');
    el.innerHTML = jsonViewer(response["data"]["store"][0]["things"], true);
  })
};



function jsonViewer(json, collapsible=false) {
    var TEMPLATES = {
        item: '<div class="json__item"><div class="json__key">%KEY%</div><div class="json__value json__value--%TYPE%">%VALUE%</div></div>',
        itemCollapsible: '<label class="json__item json__item--collapsible"><input type="checkbox" class="json__toggle"/><div class="json__key">%KEY%</div><div class="json__value json__value--type-%TYPE%">%VALUE%</div>%CHILDREN%</label>',
        itemCollapsibleOpen: '<label class="json__item json__item--collapsible"><input type="checkbox" checked class="json__toggle"/><div class="json__key">%KEY%</div><div class="json__value json__value--type-%TYPE%">%VALUE%</div>%CHILDREN%</label>'
    };

    function createItem(key, value, type){
        var element = TEMPLATES.item.replace('%KEY%', key);

        if(type == 'string') {
            element = element.replace('%VALUE%', '"' + value + '"');
        } else {
            element = element.replace('%VALUE%', value);
        }

        element = element.replace('%TYPE%', type);

        return element;
    }

    function createCollapsibleItem(key, value, type, children){
        var tpl = 'itemCollapsible';
        
        if(collapsible) {
            tpl = 'itemCollapsibleOpen';
        }
        
        var element = TEMPLATES[tpl].replace('%KEY%', key);

        element = element.replace('%VALUE%', type);
        element = element.replace('%TYPE%', type);
        element = element.replace('%CHILDREN%', children);

        return element;
    }

    function handleChildren(key, value, type) {
        var html = '';

        for(var item in value) { 
            var _key = item,
                _val = value[item];

            html += handleItem(_key, _val);
        }

        return createCollapsibleItem(key, value, type, html);
    }

    function handleItem(key, value) {
        var type = typeof value;

        if(typeof value === 'object') {        
            return handleChildren(key, value, type);
        }

        return createItem(key, value, type);
    }

    function parseObject(obj) {
        _result = '<div class="json">';

        for(var item in obj) { 
            var key = item,
                value = obj[item];

            _result += handleItem(key, value);
        }

        _result += '</div>';

        return _result;
    }
    
    return parseObject(json);
};

  </script>
</body>
